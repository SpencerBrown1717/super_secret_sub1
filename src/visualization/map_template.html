<!DOCTYPE html>
<html>
<head>
    <title>Jin-class Submarine Tracking</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        #map {
            height: 800px;
            width: 100%;
        }
        .info {
            padding: 6px 8px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            background: white;
            background: rgba(255,255,255,0.8);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 5px;
        }
        .info h4 {
            margin: 0 0 5px;
            color: #777;
        }
        .legend {
            line-height: 18px;
            color: #555;
        }
        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        // Initialize the map
        var map = L.map('map').setView([20, 120], 5);

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Submarine data will be injected here
        window.submarineForecasts = {};

        // Function to create submarine markers and paths
        function createSubmarineVisualization(subId, forecast) {
            // Create a color for this submarine
            var color = getColorForSubmarine(subId);
            
            // Add historical path
            if (forecast.history_path && forecast.history_path.length > 0) {
                L.polyline(forecast.history_path, {
                    color: color,
                    weight: 3,
                    opacity: 0.7
                }).addTo(map);
            }
            
            // Add forecast path
            if (forecast.forecast_path && forecast.forecast_path.length > 0) {
                L.polyline(forecast.forecast_path, {
                    color: color,
                    weight: 3,
                    opacity: 0.5,
                    dashArray: '5, 10'
                }).addTo(map);
            }
            
            // Add confidence rings
            if (forecast.confidence_rings) {
                forecast.confidence_rings.forEach(function(ring, index) {
                    // 67% confidence ring
                    L.circle(ring.center, {
                        radius: ring.radius_67 * 1000, // Convert km to meters
                        color: color,
                        fillColor: color,
                        fillOpacity: 0.1,
                        weight: 1
                    }).addTo(map);
                    
                    // 90% confidence ring
                    L.circle(ring.center, {
                        radius: ring.radius_90 * 1000, // Convert km to meters
                        color: color,
                        fillColor: color,
                        fillOpacity: 0.05,
                        weight: 1
                    }).addTo(map);
                });
            }
            
            // Add markers for historical positions
            if (forecast.history_path) {
                forecast.history_path.forEach(function(point, index) {
                    L.circleMarker(point, {
                        radius: 5,
                        fillColor: color,
                        color: "#000",
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 0.7
                    }).addTo(map);
                });
            }
        }

        // Function to generate a color for each submarine
        function getColorForSubmarine(subId) {
            var colors = ['#e41a1c', '#377eb8', '#4daf4a', '#984ea3', '#ff7f00', '#ffff33'];
            var index = parseInt(subId.replace('Jin', '')) - 1;
            return colors[index % colors.length];
        }

        // Create legend
        var legend = L.control({position: 'bottomright'});
        legend.onAdd = function(map) {
            var div = L.DomUtil.create('div', 'info legend');
            div.innerHTML = '<h4>Legend</h4>' +
                '<div><i style="background: #e41a1c"></i> Historical Path</div>' +
                '<div><i style="background: #e41a1c; opacity: 0.5"></i> Forecast Path</div>' +
                '<div><i style="background: #e41a1c; opacity: 0.1"></i> 67% Confidence</div>' +
                '<div><i style="background: #e41a1c; opacity: 0.05"></i> 90% Confidence</div>';
            return div;
        };
        legend.addTo(map);

        // Process submarine data when available
        document.addEventListener('DOMContentLoaded', function() {
            Object.keys(window.submarineForecasts).forEach(function(subId) {
                createSubmarineVisualization(subId, window.submarineForecasts[subId]);
            });
        });
    </script>
</body>
</html> 